---
lab:
  title: 랩 4 - Azure SQL Database 방화벽 규칙 구성
  module: Implement a Secure Environment for a Database Service
---

# 안전한 환경 구현

**예상 시간:** 30분

학생들은 단원에서 파악한 정보를 사용하여 Azure Portal 및 *AdventureWorks* 내에서 보안 기능을 구성한 후 구현합니다.

선임 데이터베이스 관리자로 고용되어 데이터베이스 환경의 보안을 보장합니다. 작업은 Azure SQL Database에 중점을 둡니다.

> &#128221; 이러한 연습에서는 T-SQL 코드를 복사하여 붙여넣고 기존 SQL 리소스를 활용하도록 요청합니다. 코드를 실행하기 전에 코드를 올바르게 복사했는지 확인하세요.

## 환경을 설정합니다.

랩 가상 머신이 제공되고 미리 구성된 경우 **C:\LabFiles** 폴더에서 랩 파일을 준비해야 합니다. *파일이 이미 있는지 잠시 확인하려면 이 섹션을 건너뜁니다.* 그러나 사용자 개인의 컴퓨터를 사용 중이거나 랩 파일이 없는 경우 계속하려면 *GitHub*에서 복제해야 합니다.

1. 랩 가상 머신 또는 로컬 컴퓨터에 제공되지 않은 경우 Visual Studio Code 세션을 시작합니다.

1. 명령 팔레트(Ctrl+Shift+P)를 열고 **Git: Clone**을 입력합니다. **Git: Clone** 옵션을 선택합니다.

1. 다음 URL을 **리포지토리 URL** 필드에 붙여넣고 **Enter** 키를 선택합니다.

    ```url
    https://github.com/MicrosoftLearning/dp-300-database-administrator.git
    ```

1. 랩 가상 머신 또는 로컬 컴퓨터가 제공되지 않은 경우 **C:\LabFiles** 폴더에 저장합니다(없는 경우 폴더 만들기).

## Azure에서 SQL Server 설정

Azure에 로그인하고 Azure에서 실행 중인 기존 Azure SQL Server 인스턴스가 있는지 확인합니다. *Azure에서 실행 중인 SQL Server 인스턴스가 이미 있는 경우 이 섹션을 건너뜁니다.*

1. 랩 가상 머신 또는 로컬 컴퓨터가 제공되지 않은 경우 Visual Studio Code 세션을 시작하고 이전 섹션에서 복제된 리포지토리로 이동합니다.

1. **/Allfiles/Labs** 폴더를 마우스 오른쪽 단추로 클릭하고 **통합 터미널에서 열기**를 선택합니다.

1. Azure CLI를 사용하여 Azure에 연결해 보겠습니다. 다음 명령을 입력하고 **Enter** 키를 선택합니다.

    ```bash
    az login
    ```

    > &#128221; 브라우저 창이 열립니다. Azure 자격 증명을 사용하여 로그인합니다.

1. Azure에 로그인한 후에는 리소스 그룹이 아직 없는 경우 리소스 그룹을 만들고 해당 리소스 그룹 아래에 SQL Server 및 데이터베이스를 만듭니다. 다음 명령을 입력하고 **Enter** 키를 선택합니다. *스크립트를 완료하는 데 몇 분 정도 걸립니다.*

    ```bash
    cd ./Setup
    ./deploy-sql-database.ps1
    ```

    > &#128221; 기본적으로 이 스크립트는 **contoso-rg**라는 리소스 그룹을 만들거나, 있는 경우 *contoso-rg*로 시작하는 리소스를 사용합니다. 기본적으로 **미국 서부 2** 지역(westus2)에도 모든 리소스가 만들어집니다. 마지막으로 **SQL 관리자 암호**에 대한 임의의 12자 암호를 생성합니다. 이러한 값은 고유 값으로 **-rgName**, **-location** 및 **-sqlAdminPw** 매개 변수 중 하나 이상을 사용하여 변경할 수 있습니다. 암호는 12자 이상의 Azure SQL 암호 복잡성 요구 사항을 충족해야 하며 대문자 1개, 소문자 1개, 숫자 1개, 특수 문자 1개 이상을 포함해야 합니다.

    > &#128221; 스크립트는 SQL Server 방화벽 규칙에 현재 공용 IP 주소를 추가합니다.

1. 스크립트가 완료되면 리소스 그룹 이름, SQL Server 이름 및 데이터베이스 이름, 관리자 사용자 이름 및 암호를 반환합니다. *이러한 값은 랩의 뒷부분에서 필요하므로 기록해 두십시오*.

---

## Azure SQL Database 방화벽 규칙 구성

1. 랩 가상 머신 또는 로컬 컴퓨터가 제공되지 않은 경우 브라우저 세션을 시작하고 [https://portal.azure.com](https://portal.azure.com/)으로 이동합니다. Azure 자격 증명을 사용하여 Portal에 연결합니다.

1. Azure Portal의 맨 위에 있는 검색 상자에서 *SQL Server*를 검색한 다음 옵션 목록에서 **SQL Server**를 클릭합니다.

1. SQL Server **dp300-lab-xxxxxxxx**를 선택합니다. 여기서 *xxxxxxxx* 는 임의의 숫자 문자열입니다.

    > &#128221; 이 랩에서 만들지 않은 사용자 고유의 Azure SQL Server를 사용하는 경우 해당 SQL 서버의 이름을 선택합니다.

1. SQL Server의 *개요* 화면에서 서버 이름 오른쪽에 있는 **클립보드에 복사** 단추를 선택합니다.

1. **네트워킹 설정 표시**를 선택합니다.

1. **네트워킹** 페이지의 **방화벽 규칙**에 따라 목록을 검토하고 클라이언트 IP 주소가 나열되어 있는지 확인합니다. 나열되지 않은 경우 **+ 클라이언트 IPv4 주소(IP 주소) 추가**를 선택한 후 **저장**을 선택합니다.

    > &#128221; 참고: 클라이언트 IP 주소가 자동으로 입력되었습니다. 목록에 클라이언트 IP 주소를 추가하면 SSMS(SQL Server Management Studio) 또는 다른 클라이언트 도구를 사용하여 Azure SQL Database에 연결할 수 있습니다. **클라이언트 IP 주소를 기록해두면 나중에 사용할 수 있습니다.**

1. SQL Server Management Studio를 엽니다. 서버에 연결 대화 상자에서 Azure SQL Database 서버의 이름을 붙여넣고 다음 자격 증명으로 로그인합니다.

    - **서버 이름:** &lt;여기에 Azure SQL Database 서버 이름 붙여넣기&gt;__
    - **인증:** SQL Server 인증
    - **서버 관리자 로그인:** 사용자의 Azure SQL Database 서버 관리자 로그인
    - **암호:** 사용자의 Azure SQL Database 서버 관리자 암호

1. **연결**을 선택합니다.

1. 개체 탐색기에서 서버 노드를 확장하고 **데이터베이스**를 마우스 오른쪽 단추로 클릭합니다. **데이터 계층 애플리케이션 가져오기**를 선택합니다.

1. **데이터 계층 애플리케이션 가져오기** 대화 상자의 첫 번째 화면에서 **다음**을 클릭합니다.

1. **가져오기 설정** 화면에서 **찾아보기**를 클릭하고 **C:\LabFiles\dp-300-database-administrator\Allfiles\Labs\04** 폴더로 이동하여 **AdventureWorksLT.bacpac** 파일을 클릭한 후 **열기**를 클릭합니다. **데이터 계층 애플리케이션 가져오기** 화면으로 돌아가서 **다음**을 선택합니다.

1. **데이터베이스 설정** 화면에서 아래와 같이 변경합니다.

    - **데이터베이스 이름:** AdventureWorksFromBacpac
    - **Microsoft Azure SQL Database의 버전**: 기본

1. **다음**을 선택합니다.

1. **요약** 화면에서 **완료**를 선택합니다. 이 작업은 몇 분 정도 걸릴 수 있습니다. 가져오기가 완료되면 아래 결과가 표시됩니다. 그런 다음 **닫기**를 선택합니다.

1. SQL Server Management Studio로 돌아가서 **개체 탐색기**의 **Databases** 폴더를 펼칩니다. 그런 다음 **AdventureWorksFromBacpac** 데이터베이스를 마우스 오른쪽 단추로 클릭한 다음 **새 쿼리**를 클릭합니다.

1. 텍스트를 쿼리 창에 붙여넣어 다음 T-SQL 쿼리를 실행합니다.
    1. **중요:****000.000.000.000**을 클라이언트 IP 주소로 바꿉니다. **실행**을 선택합니다.

    ```sql
    EXECUTE sp_set_database_firewall_rule 
            @name = N'AWFirewallRule',
            @start_ip_address = '000.000.000.000', 
            @end_ip_address = '000.000.000.000'
    ```

1. 다음으로 **AdventureWorksFromBacpac** 데이터베이스에 포함된 사용자를 만듭니다. **새 쿼리**를 선택하고 다음 T-SQL을 실행합니다.

    ```sql
    USE [AdventureWorksFromBacpac]
    GO
    CREATE USER ContainedDemo WITH PASSWORD = 'P@ssw0rd01'
    ```

    > &#128221; 이 명령은 **AdventureWorksFromBacpac** 데이터베이스 내에 포함된 사용자를 만듭니다. 다음 단계에서 이 자격 증명을 테스트합니다.

1. **개체 탐색기**로 이동합니다. **연결**을 클릭한 다음 **데이터베이스 엔진**을 클릭합니다.

1. 이전 단계에서 생성된 자격 증명을 사용하여 연결을 시도합니다. 다음 정보를 사용해야 합니다.

    - **로그인:** ContainedDemo
    - **암호:** P@ssw0rd01

     **연결**을 클릭합니다.

     다음과 같은 오류가 표시됩니다.

    <span style="color:red">사용자 'ContainedDemo'에 대한 로그인 실패(Microsoft SQL Server, 오류: 18456)</span>

    > &#128221; 연결 과정에서 사용자가 생성된 **AdventureWorksFromBacpac**이 아닌 *master* 데이터베이스에 로그인을 시도했기 때문에 이 오류가 생성되었습니다. **확인**을 선택하여 오류 메시지를 종료한 후 **서버에 연결**에서 **옵션 >>** 을 선택하여 연결 컨텍스트를 변경합니다.

1. **연결 속성** 탭에서 데이터베이스 이름 **AdventureWorksFromBacpac**을 입력한 후 **연결**을 선택합니다.

1. **ContainedDemo** 사용자를 사용하여 성공적으로 인증할 수 있었습니다. 이번에는 새로 만든 사용자가 액세스할 수 있는 유일한 데이터베이스인 **AdventureWorksFromBacpac**에 직접 로그인했습니다.

---

## 리소스 정리

다른 용도로 Azure SQL Server를 사용하지 않는 경우 이 랩에서 만든 리소스를 정리할 수 있습니다.

### 리소스 그룹 삭제

이 랩에 대한 새 리소스 그룹을 만든 경우 리소스 그룹을 삭제하여 이 랩에서 만든 모든 리소스를 제거할 수 있습니다.

1. Azure Portal의 왼쪽 탐색 창에서 **리소스 그룹**을 선택하거나 검색 창에서 **리소스 그룹**을 검색하고 결과에서 선택합니다.

1. 이 랩을 위해 만든 리소스 그룹으로 이동합니다. 리소스 그룹에는 Azure SQL Server 및 이 랩에서 만든 기타 리소스가 포함됩니다.

1. 위쪽 메뉴에서 **리소스 그룹 삭제**를 선택합니다.

1. **리소스 그룹 삭제** 대화 상자에서 확인할 리소스 그룹의 이름을 입력한 다음 **삭제**를 선택합니다.

1. 리소스 그룹이 삭제될 때까지 기다립니다.

1. Azure Portal을 닫습니다.

### 랩 리소스만 삭제합니다.

이 랩에 대한 새 리소스 그룹을 만들지 않았고 리소스 그룹과 이전 리소스를 그대로 유지하려는 경우 이 랩에서 만든 리소스를 계속 삭제할 수 있습니다.

1. Azure Portal의 왼쪽 탐색 창에서 **리소스 그룹**을 선택하거나 검색 창에서 **리소스 그룹**을 검색하고 결과에서 선택합니다.

1. 이 랩을 위해 만든 리소스 그룹으로 이동합니다. 리소스 그룹에는 Azure SQL Server 및 이 랩에서 만든 기타 리소스가 포함됩니다.

1. 랩에서 이전에 지정한 SQL Server 이름이 접두사로 지정된 모든 리소스를 선택합니다.

1. 위쪽 메뉴에서 **삭제**를 선택합니다.

1. **리소스 삭제** 대화 상자에서 **삭제**를 입력하고 **삭제**를 선택합니다.

1. 리소스 삭제를 확인하려면 **삭제**를 다시 선택합니다.

1. 리소스가 삭제될 때까지 기다립니다.

1. Azure Portal을 닫습니다.

### LabFiles 폴더 삭제

이 랩에 대해 새 LabFiles 폴더를 만들었고 더 이상 필요하지 않은 경우 LabFiles 폴더를 삭제하여 이 랩에서 만든 모든 파일을 제거할 수 있습니다.

1. 랩 가상 머신 또는 로컬 컴퓨터가 제공되지 않은 경우 파일 탐색기를 열고 **C:\\** 드라이브로 이동합니다.
1. **LabFiles** 폴더를 마우스 오른쪽 단추로 클릭하고 **삭제**를 선택합니다.
1. **예**를 선택하여 폴더 삭제를 확인합니다.

---

이 랩을 성공적으로 완료하셨습니다.

이 연습에서는 Azure SQL Database에서 호스트되는 데이터베이스에 액세스하도록 서버 및 데이터베이스 방화벽 규칙을 구성했습니다. 또한 T-SQL 문을 사용하여 포함된 사용자를 만들고 SQL Server Management Studio를 사용하여 액세스를 확인했습니다.
